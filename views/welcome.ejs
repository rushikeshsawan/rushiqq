<% if(session.user_id){ %>
  <!DOCTYPE html>
  <html lang="en">

  <%- include ('components/header.ejs') %>

    <body class="g-sidenav-show   bg-gray-100">

      <div class="min-height-300 bg-success position-absolute w-100"></div>
      <%- include ('components/leftsidenav.ejs') %>
        <main class="main-content position-relative border-radius-lg ">
          <%-include ('components/navbar.ejs') %>
            <%- include ('components/uppercards.ejs') %>
              <%- include ('components/rightsidenav.ejs') %>
                <%- include ('components/jsscripts.ejs') %>
                  <%- include ('components/addnewproductmodal.ejs') %>
                    <%- include ('components/addbatchproductmodal.ejs') %>
                      <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
                      <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


                      <script>

                        document.getElementsByClassName('loading')[0].style.visibility = 'hidden';
                        $(".addbatchproducthidden").hide();
                        $(".addnewproducthidden").hide();


                        let hidden = document.getElementById('hidethis');
                        let hidden1 = document.getElementById('spacehide');
                        let enlargediv = document.getElementById('product-details');


                        hidden.style.display = 'none';


                        if (params.search('productdetails') > 0) {
                          // enlargediv.removeClass('medium');
                          // enlargediv.removeClass('large');
                          hidden.style.display = 'block';

                        } else {
                          hidden1.style.display = 'block';

                        }
                        console.log(params.search('productdetails'));


                      </script>
                      <script>
                        $('form').submit(function (e) {
                          e.preventDefault();
                          $('.loader').addClass('d-none');
                          let form = $(this);
                          let data = {};
                          $(this).find('input,select,textarea').each(function () {
                            data[$(this).attr('name')] = $(this).val();
                          });
                          // if($(this).attr('action')==""
                          if ($(this).attr('action') == "/addbatchproduct") {
                            $(".addbatchproducthide").hide();
                            // document.getElementsByClassName('loading')[0].style.visibility = 'block';
                            $(".addbatchproducthidden").show();

                          }
                          if ($(this).attr('action') == "/addnewproduct") {
                            $(".addnewproducthide").hide();
                            // document.getElementsByClassName('loading')[0].style.visibility = 'block';
                            $(".addnewproducthidden").show();

                          }
                          $('.loader').removeClass('d-none');
                          $.ajax({
                            url: $(this).attr('action'),
                            method: 'POST',
                            data: data,
                            dataType: "json",
                            success: function (data) {
                              console.log(data);

                              function gettime(timee) {
                                var a = new Date(timee * 1000);
                                var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                var year = a.getFullYear();
                                var month = months[a.getMonth()];
                                var date = a.getDate();
                                var hour = a.getHours();
                                var min = a.getMinutes();
                                var sec = a.getSeconds();
                                var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
                                return time;
                              }
                              // console.log(data);
                              //  document.getElementsByClassName('loading')[0].style.visibility = 'hidden';
                              $(".addbatchproducthide").show();
                              $(".addbatchproducthidden").hide();
                              let succ = data.successful;
                              let unsucc = data.unsuccessful;
                              if (data.addbatchproduct == "addbatchproduct") {

                                if (data.successful.receipt.status == false) {
                                  Swal.fire({
                                    title: '<strong> <u>Amron Switches</u></strong>',
                                    icon: 'danger',
                                    html:
                                      `Some Error Occured Please Check the Value or Try again Later.<br>`
                                    ,
                                    showCloseButton: true,
                                    showCancelButton: true,
                                    focusConfirm: false,
                                    confirmButtonText:
                                      '<i class="fa fa-thumbs-up"></i> Great!',
                                    confirmButtonAriaLabel: 'Thumbs up, great!',
                                    cancelButtonText:
                                      '<i class="fa fa-thumbs-down"></i>',
                                    cancelButtonAriaLabel: 'Thumbs down'
                                  })
                                }
                                else {



                                  let msg = "<b> product Succesfully Inserted are-> <b>" + succ;


                                  let msg1 = " <b>product not Succesfully Inserted are-> <b>" + unsucc;

                                  Swal.fire({
                                    title: '<strong> <u>Amron Switches</u></strong>',
                                    icon: 'success',
                                    html:
                                      `${msg}<br>` + `${msg1}`
                                    ,
                                    showCloseButton: true,
                                    showCancelButton: true,
                                    focusConfirm: false,
                                    confirmButtonText:
                                      '<i class="fa fa-thumbs-up"></i> Great!',
                                    confirmButtonAriaLabel: 'Thumbs up, great!',
                                    cancelButtonText:
                                      '<i class="fa fa-thumbs-down"></i>',
                                    cancelButtonAriaLabel: 'Thumbs down'
                                  })
                                }


                                // swal("Good job!", "product added successfully->" + succ + "product not added successfully->" + unsucc, "success");
                              }

                              if (data.productdetails == true) {
                                if (data.success == false) {

                                  Swal.fire({
                                    title: '<strong> <u>Amron Switches</u></strong>',
                                    icon: 'warning',
                                    html:
                                      `Invalid Product Id Please Check Your Product Id.`
                                    ,
                                    showCloseButton: true,
                                    showCancelButton: true,
                                    focusConfirm: false,
                                    confirmButtonText:
                                      '<i class="fa fa-thumbs-up"></i> Great!',
                                    confirmButtonAriaLabel: 'Thumbs up, great!',
                                    cancelButtonText:
                                      '<i class="fa fa-thumbs-down"></i>',
                                    cancelButtonAriaLabel: 'Thumbs down'
                                  })
                               

                              } else {

                                $('#pname').html("Brand Name: " + data.success[0]);
                                $('#rcurrent').html("Rated Current:  " + data.success[1]);
                                $('#soperation').html("Switch Operation: " + data.success[2]);
                                $('#msize').html("Module Size: " + data.success[3]);
                                $('#material').html("Material: " + data.success[4]);
                                $('#coo').html("Country Of Origin: " + data.success[5]);
                                $('#pcolor').html("Product Color: " + data.success[6]);
                                // $('#pweight').html(" Product Weight: " + data.success[7]);
                                // $('#plength').html("Product Length: " + data.success[8]);
                                $('#manudate').html("Manufacture Date: " + gettime(data.success[7]));
                                $('#warr_start').html("Warranty Start: " + gettime(data.success[8]));
                                $('#warr_end').html("Warranty End: " + gettime(data.success[9]));
                                $('#pperiod').html("Warranty Period: " + data.success[10]);
   
                                hidden.style.display = 'block';
                              }
                              } else if(data['status'] == true) {
                            $(".addnewproducthide").show();
                            $(".addnewproducthidden").hide();
                            let unsold = $('#unsoldnum').html();
                            console.log(unsold);
                            unsold++;
                            $('#addnewproductmodal').modal('hide');
                            $('#unsoldnum').html(unsold);
                            swal("Good job!", "Form Submitted Successfully.!", "success");
                          }
                          // form.trigger('reset');

                        }
                          ,
                          error: function (error) {
                            console.log(error);
                            // form.trigger('reset');
                            swal("Sorry!", "Cannot save form.!", "error");
                            $('.loader').addClass('d-none');

                          }
                              });
                            });
                      </script>


    </body>

  </html>

  <% }else{ %>
    <script> document.location.href = '/' </script>
    <% } %>